<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NCK Forskningsöversikt</title>
    <style>
        /* Globala stilar */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            padding: 20px;
            background-color: #f4f4f4;
            color: #333;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #004d99; /* Mörkblå för rubrik */
        }

        /* Filter- och Form-containers */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        #filters, #addProjectForm {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        label {
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
            color: #555;
        }

        input[type="text"], select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
        }

        textarea {
            grid-column: 1 / -1; /* Gör så att textarea tar upp hela bredden */
            min-height: 100px;
            resize: vertical;
        }

        button {
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: background-color 0.3s ease;
        }

        /* Knapp för att lägga till/spara projekt */
        #addProjectForm button {
            background-color: #007bff; /* Blå */
            color: white;
        }

        #addProjectForm button:hover {
            background-color: #0056b3;
        }

        /* Sökknapp */
        #searchButton {
            background-color: #28a745; /* Grön */
            color: white;
            grid-column: auto;
        }

        #searchButton:hover {
            background-color: #1e7e34;
        }

        /* Resultatlistan */
        #results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            padding-top: 20px;
        }

        .project-card {
            background: #f9f9f9;
            padding: 20px;
            border: 1px solid #ddd;
            border-left: 5px solid #004d99; /* Blå kantmarkering */
            border-radius: 4px;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s;
            position: relative; /* För att positionera knapparna */
        }

        .project-card:hover {
            transform: translateY(-3px);
            box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.1);
        }

        .project-card h3 {
            margin-top: 0;
            color: #004d99;
            border-bottom: 1px dotted #ccc;
            padding-bottom: 5px;
            margin-bottom: 10px;
        }

        .project-card p {
            margin-bottom: 5px;
        }
        
        /* Knapparna i korten */
        .card-actions {
            margin-top: 15px;
            display: flex;
            justify-content: flex-end; /* Flyttar knapparna till höger */
            gap: 10px;
        }
        
        .edit-btn {
            background-color: #ffc107; /* Gul (Redigera) */
            color: #333;
        }
        .edit-btn:hover {
            background-color: #e0a800;
        }
        
        .delete-btn {
            background-color: #dc3545; /* Röd (Ta bort) */
            color: white;
        }
        .delete-btn:hover {
            background-color: #c82333;
        }
        
        /* Flexibel layout för formulärknappen */
        #addProjectForm > div {
            display: flex;
            align-items: flex-end; /* Knappen alignas i botten */
        }
        #addProjectForm button {
            width: 100%;
        }
    </style>
</head>
<body>

    <h1>NCK Forskningsöversikt</h1>

    <div class="container">
        <h2>Lägg till / Redigera Projekt</h2>
        <form id="addProjectForm" onsubmit="event.preventDefault(); addProject();">
            <div>
                <label for="titel">Titel:</label>
                <input type="text" id="titel" required>
            </div>
            <div>
                <label for="status">Status:</label>
                <select id="status" required>
                    <option value="Planerad">Planerad</option>
                    <option value="Pågående">Pågående</option>
                    <option value="Avslutad">Avslutad</option>
                </select>
            </div>
            <div>
                <label for="datum">Datumintervall (YYYY-YYYY eller YYYY-):</label>
                <input type="text" id="datum" placeholder="t.ex. 2024-2025" required>
            </div>
            <div>
                <label for="deltagare">Deltagare (kommaseparerat):</label>
                <input type="text" id="deltagare" placeholder="t.ex. Anna, Pelle">
            </div>
            <div style="grid-column: 1 / -1;">
                <label for="beskrivning">Beskrivning:</label>
                <textarea id="beskrivning"></textarea>
            </div>
            <div>
                <button type="submit">Lägg till projekt</button>
            </div>
        </form>
    </div>


    <div class="container">
        <h2>Filter & Sök</h2>
        <div id="filters">
            <div>
                <label for="statusFilter">Status:</label>
                <select id="statusFilter" onchange="applyFilters()">
                    <option value="">Alla statusar</option>
                    <option value="Planerad">Planerad</option>
                    <option value="Pågående">Pågående</option>
                    <option value="Avslutad">Avslutad</option>
                </select>
            </div>
            <div>
                <label for="yearFilter">År:</label>
                <select id="yearFilter" onchange="applyFilters()">
                    <option value="">Alla år</option>
                    </select>
            </div>
            <div>
                <label for="searchQuery">Fritextsökning:</label>
                <input type="text" id="searchQuery" placeholder="Titel, deltagare, beskrivning...">
            </div>
            <div>
                <button id="searchButton" onclick="applyFilters()">Sök</button>
            </div>
        </div>
    </div>


    <div class="container">
        <h2>Projektresultat</h2>
        <div id="results">
            </div>
    </div>

    <script>
        // =========================================================
        // 1. Initialisering, Data och Lagring (LocalStorage)
        // =========================================================

        let editingProjectId = null;

        function loadProjects() {
            const storedProjects = localStorage.getItem('nckProjects');
            if (storedProjects) {
                return JSON.parse(storedProjects);
            }
            
            // Tom startdata (ingen standardlista med projekt)
            return [];
        }

        let projects = loadProjects();

        function saveProjects() {
            localStorage.setItem('nckProjects', JSON.stringify(projects));
            applyFilters(); 
        }


        // =========================================================
        // 2. Lägg till/Uppdatera/Ta Bort Funktioner
        // =========================================================

        function addProject() {
            const titel = document.getElementById('titel').value.trim();
            const status = document.getElementById('status').value.trim();
            const datum = document.getElementById('datum').value.trim();
            const deltagare = document.getElementById('deltagare').value.trim();
            const beskrivning = document.getElementById('beskrivning').value.trim();
            
            if (!titel || !status || !datum) {
                alert("Titel, Status och Datum måste fyllas i.");
                return;
            }

            if (editingProjectId) {
                // UPPFATERA BEFINTLIGT PROJEKT
                const projectIndex = projects.findIndex(p => p.id === editingProjectId);
                if (projectIndex !== -1) {
                    projects[projectIndex] = {
                        id: editingProjectId,
                        titel,
                        status,
                        datum,
                        deltagare,
                        beskrivning
                    };
                }
                editingProjectId = null;
                document.querySelector('#addProjectForm button').textContent = 'Lägg till projekt';
            } else {
                // LÄGG TILL NYTT PROJEKT
                const newProject = {
                    id: 'p' + Date.now(), 
                    titel,
                    status,
                    datum,
                    deltagare,
                    beskrivning
                };
                projects.push(newProject);
            }

            document.getElementById('addProjectForm').reset();
            saveProjects(); 
            populateYearFilter();
        }

        // Sätter igång redigeringsläget
        function editProject(projectId) {
            const projectToEdit = projects.find(p => p.id === projectId);
            
            if (projectToEdit) {
                document.getElementById('titel').value = projectToEdit.titel;
                document.getElementById('status').value = projectToEdit.status;
                document.getElementById('datum').value = projectToEdit.datum;
                document.getElementById('deltagare').value = projectToEdit.deltagare;
                document.getElementById('beskrivning').value = projectToEdit.beskrivning;

                editingProjectId = projectId;
                document.querySelector('#addProjectForm button').textContent = 'Spara ändringar';
                document.getElementById('addProjectForm').scrollIntoView({ behavior: 'smooth' });
            }
        }
        
        // Tar bort ett projekt permanent
        function deleteProject(projectId) {
            if (confirm("Är du säker på att du vill ta bort detta projekt permanent?")) {
                projects = projects.filter(p => p.id !== projectId);
                saveProjects();
                populateYearFilter();
            }
        }


        // =========================================================
        // 3. Filter och Visning
        // =========================================================

        function populateYearFilter() {
            const yearFilter = document.getElementById('yearFilter');
            yearFilter.innerHTML = '<option value="">Alla år</option>'; 
            
            const currentYear = new Date().getFullYear();
            const futureLimit = currentYear + 10;
            const years = new Set();
            
            projects.forEach(project => {
                if (project.datum) {
                    const parts = project.datum.split('-').map(y => y.trim()).filter(y => y !== '');
                    
                    if (parts.length === 1) {
                        years.add(parseInt(parts[0]));
                    } else if (parts.length === 2) {
                        const start = parseInt(parts[0]);
                        const end = parseInt(parts[1]) || futureLimit; 
                        
                        if (!isNaN(start) && !isNaN(end)) {
                            const maxEnd = Math.min(end, futureLimit); 
                            for (let year = start; year <= maxEnd; year++) {
                                years.add(year);
                            }
                        }
                    } else {
                        const yearMatches = project.datum.match(/\b\d{4}\b/g);
                        if (yearMatches) {
                            yearMatches.forEach(y => years.add(parseInt(y)));
                        }
                    }
                }
            });

            const sortedYears = Array.from(years)
                .filter(y => !isNaN(y))
                .sort((a, b) => b - a); 
            
            sortedYears.forEach(year => {
                const option = document.createElement('option');
                option.value = year.toString();
                option.textContent = year.toString();
                yearFilter.appendChild(option);
            });
        }

        function applyFilters() {
            const statusFilter = document.getElementById('statusFilter').value.toLowerCase();
            const yearFilter = document.getElementById('yearFilter').value;
            const searchQuery = document.getElementById('searchQuery').value.toLowerCase().trim();

            let filteredProjects = projects.filter(project => {
                // 1. Statusfilter
                const statusMatch = !statusFilter || project.status.toLowerCase() === statusFilter;

                // 2. År-filter
                const yearMatch = !yearFilter || (
                    project.datum && project.datum.split('-').length >= 1 && (
                        (project.datum.includes(yearFilter)) || 
                        (
                            project.datum.split('-').length >= 2 && 
                            parseInt(yearFilter) >= parseInt(project.datum.split('-')[0].trim()) && 
                            (project.datum.split('-')[1].trim() === '' || parseInt(yearFilter) <= parseInt(project.datum.split('-')[1].trim()))
                        )
                    )
                );

                // 3. Fritextsökning
                const searchMatch = !searchQuery || 
                    project.titel.toLowerCase().includes(searchQuery) ||
                    project.beskrivning.toLowerCase().includes(searchQuery) ||
                    project.deltagare.toLowerCase().includes(searchQuery);

                return statusMatch && yearMatch && searchMatch;
            });

            displayProjects(filteredProjects);
        }

        // Visar projekten i DOM
        function displayProjects(projectsToDisplay) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';

            if (projectsToDisplay.length === 0) {
                resultsDiv.innerHTML = '<p>Inga projekt matchar dina filter och sökning. Lägg till ditt första projekt ovan!</p>';
                return;
            }

            projectsToDisplay.forEach(project => {
                const projectDiv = document.createElement('div');
                projectDiv.className = 'project-card';
                projectDiv.innerHTML = `
                    <h3>${project.titel}</h3>
                    <p><strong>Status:</strong> ${project.status}</p>
                    <p><strong>Datum:</strong> ${project.datum}</p>
                    <p><strong>Deltagare:</strong> ${project.deltagare || 'Ej specificerat'}</p>
                    <p>${project.beskrivning || ''}</p>
                    
                    <div class="card-actions">
                        <button onclick="editProject('${project.id}')" class="edit-btn">Redigera</button>
                        <button onclick="deleteProject('${project.id}')" class="delete-btn">Ta bort</button>
                    </div>
                `;
                resultsDiv.appendChild(projectDiv);
            });
        }


        // =========================================================
        // 4. Starta applikationen
        // =========================================================

        document.addEventListener('DOMContentLoaded', () => {
            populateYearFilter(); 
            applyFilters(); 
            
            document.getElementById('searchQuery').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    applyFilters();
                }
            });
        });

    </script>

</body>
</html>
