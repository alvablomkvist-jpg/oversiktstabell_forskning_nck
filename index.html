<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NCK Forskningsöversikt</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: #f5f5f5;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        header {
            background: #333;
            color: white;
            padding: 30px;
        }
        
        h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .subtitle {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .top-actions {
            padding: 20px 30px;
            background: #f9f9f9;
            border-bottom: 2px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .btn {
            padding: 10px 20px;
            border: 2px solid #333;
            background: white;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .btn:hover {
            background: #333;
            color: white;
        }
        
        .btn-primary {
            background: #333;
            color: white;
        }
        
        .btn-primary:hover {
            background: #555;
            border-color: #555;
        }

        .btn-danger {
            background: #fff;
            color: #d9534f;
            border-color: #d9534f;
        }

        .btn-danger:hover {
            background: #d9534f;
            color: white;
        }
        
        .filters {
            padding: 25px 30px;
            background: #fafafa;
            border-bottom: 2px solid #e0e0e0;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .search-box {
            flex: 1;
            min-width: 250px;
        }
        
        .search-box input {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #333;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .filter-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .filter-group label {
            font-size: 14px;
            font-weight: 600;
            color: #333;
        }
        
        .filter-group select {
            padding: 8px 12px;
            border: 2px solid #333;
            border-radius: 6px;
            font-size: 14px;
            background: white;
            font-weight: 500;
        }
        
        .stats {
            padding: 20px 30px;
            display: flex;
            gap: 20px;
            background: #f9f9f9;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .stat-card {
            flex: 1;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 2px solid #333;
        }
        
        .stat-number {
            font-size: 32px;
            font-weight: bold;
            color: #333;
        }
        
        .stat-label {
            font-size: 13px;
            color: #666;
            margin-top: 5px;
            font-weight: 600;
        }
        
        .projects {
            padding: 30px;
        }
        
        .project-card {
            background: white;
            border: 2px solid #333;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.2s;
            position: relative; /* För att positionera åtgärder inuti */
        }
        
        .project-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .project-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }
        
        .project-title {
            font-size: 18px;
            font-weight: 700;
            color: #333;
            flex: 1;
            padding-right: 20px; /* Utrymme från status/åtgärder */
        }
        
        .status-and-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-and-actions select {
            padding: 6px 10px;
            border: 2px solid #333;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 700;
            background: white;
            white-space: nowrap;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .action-btn {
            padding: 6px 10px;
            border: 2px solid #333;
            background: white;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .action-btn:hover {
            background: #333;
            color: white;
        }

        .action-btn.delete {
            border-color: #d9534f;
            color: #d9534f;
        }

        .action-btn.delete:hover {
            background: #d9534f;
            color: white;
        }
        
        .project-meta {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 12px;
            font-size: 14px;
            color: #555;
        }
        
        .meta-item {
            display: flex;
            gap: 8px;
        }
        
        .meta-label {
            font-weight: 700;
            color: #333;
            min-width: 110px;
        }
        
        .meta-value {
            flex: 1;
        }
        
        .no-results {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }
        
        .no-results-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
        }
        
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 700px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            border: 3px solid #333;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #333;
        }
        
        .modal-title {
            font-size: 24px;
            font-weight: 700;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #333;
            font-weight: bold;
            padding: 0;
            width: 30px;
            height: 30px;
            line-height: 1;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            font-weight: 700;
            margin-bottom: 8px;
            color: #333;
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #333;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
        }
        
        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 2px solid #eee;
        }
        
        @media (max-width: 768px) {
            .filters {
                flex-direction: column;
                align-items: stretch;
            }
            
            .stats {
                flex-direction: column;
            }
            
            .project-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .status-and-actions {
                margin-top: 10px;
                flex-direction: column;
                align-items: flex-start;
                width: 100%;
                gap: 5px;
            }

            .status-and-actions select,
            .action-btn {
                width: 100%;
            }

            .project-title {
                padding-right: 0;
            }
            
            .top-actions {
                flex-direction: column;
                gap: 10px;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>NCK Forskningsöversikt</h1>
            <div class="subtitle">Alla forskningsprojekt på ett ställe – enkelt att söka, filtrera och uppdatera</div>
        </header>
        
        <div class="top-actions">
            <div style="font-size: 14px; color: #666; font-weight: 600;">
                Tillgänglig design utan färgkodning
            </div>
            <button class="btn btn-primary" onclick="openAddModal()">+ Lägg till nytt projekt</button>
        </div>
        
        <div class="filters">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="🔍 Sök på projektnamn, projektledare, finansiering..." onkeyup="applyFilters()">
            </div>
            <div class="filter-group">
                <label for="statusFilter">Status:</label>
                <select id="statusFilter" onchange="applyFilters()">
                    <option value="">Alla</option>
                    <option value="Pågående">Pågående</option>
                    <option value="Planerad">Planerad</option>
                    <option value="Ansökan">Ansökan</option>
                    <option value="Avslutad">Avslutad</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="yearFilter">År:</label>
                <select id="yearFilter" onchange="applyFilters()">
                    <option value="">Alla år</option>
                </select>
            </div>
        </div>
        
        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="statPågående">0</div>
                <div class="stat-label">PÅGÅENDE PROJEKT</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="statPlanerad">0</div>
                <div class="stat-label">PLANERADE PROJEKT</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="statAnsökan">0</div>
                <div class="stat-label">PÅGÅENDE ANSÖKNINGAR</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="statTotal">0</div>
                <div class="stat-label">VISADE PROJEKT TOTALT</div>
            </div>
        </div>
        
        <div class="projects" id="projectsList"></div>
    </div>

    <div class="modal" id="addModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Lägg till nytt projekt</h2>
                <button class="close-btn" onclick="closeAddModal()">&times;</button>
            </div>
            <form id="addProjectForm" onsubmit="addProject(event)">
                <div class="form-group">
                    <label for="newNamn">Projektnamn *</label>
                    <input type="text" id="newNamn" required>
                </div>
                <div class="form-group">
                    <label for="newStatus">Status *</label>
                    <select id="newStatus" required>
                        <option value="Pågående">Pågående</option>
                        <option value="Planerad">Planerad</option>
                        <option value="Ansökan">Ansökan</option>
                        <option value="Avslutad">Avslutad</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="newDatum">Tidsperiod (format: ÅÅÅÅ-ÅÅÅÅ)</label>
                    <input type="text" id="newDatum" placeholder="t.ex. 2024-2026">
                </div>
                <div class="form-group">
                    <label for="newProjektledare">Projektledare</label>
                    <input type="text" id="newProjektledare">
                </div>
                <div class="form-group">
                    <label for="newMedarbetare">Projektmedarbetare</label>
                    <input type="text" id="newMedarbetare">
                </div>
                <div class="form-group">
                    <label for="newSyfte">Syfte/frågeställningar</label>
                    <textarea id="newSyfte"></textarea>
                </div>
                <div class="form-group">
                    <label for="newAnknytning">Internationell anknytning</label>
                    <input type="text" id="newAnknytning">
                </div>
                <div class="form-group">
                    <label for="newFinansiering">Finansiering</label>
                    <input type="text" id="newFinansiering">
                </div>
                <div class="form-group">
                    <label for="newEtik">Etikgodkännande</label>
                    <select id="newEtik">
                        <option value="">Välj...</option>
                        <option value="Ja">Ja</option>
                        <option value="Ja, behövs">Ja, behövs</option>
                        <option value="Nej">Nej</option>
                        <option value="Måste undersökas">Måste undersökas</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="newDatalagring">Datalagring</label>
                    <input type="text" id="newDatalagring">
                </div>
                <div class="form-group">
                    <label for="newPublikationer">Publikationer/resultat</label>
                    <textarea id="newPublikationer"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn" onclick="closeAddModal()">Avbryt</button>
                    <button type="submit" class="btn btn-primary">Spara projekt</button>
                </div>
            </form>
        </div>
    </div>

    <div class="modal" id="editModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Redigera projekt</h2>
                <button class="close-btn" onclick="closeEditModal()">&times;</button>
            </div>
            <form id="editProjectForm" onsubmit="saveEdit(event)">
                <input type="hidden" id="editProjectIndex">

                <div class="form-group">
                    <label for="editNamn">Projektnamn *</label>
                    <input type="text" id="editNamn" required>
                </div>
                <div class="form-group">
                    <label for="editStatus">Status *</label>
                    <select id="editStatus" required>
                        <option value="Pågående">Pågående</option>
                        <option value="Planerad">Planerad</option>
                        <option value="Ansökan">Ansökan</option>
                        <option value="Avslutad">Avslutad</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editDatum">Tidsperiod (format: ÅÅÅÅ-ÅÅÅÅ)</label>
                    <input type="text" id="editDatum" placeholder="t.ex. 2024-2026">
                </div>
                <div class="form-group">
                    <label for="editProjektledare">Projektledare</label>
                    <input type="text" id="editProjektledare">
                </div>
                <div class="form-group">
                    <label for="editMedarbetare">Projektmedarbetare</label>
                    <input type="text" id="editMedarbetare">
                </div>
                <div class="form-group">
                    <label for="editSyfte">Syfte/frågeställningar</label>
                    <textarea id="editSyfte"></textarea>
                </div>
                <div class="form-group">
                    <label for="editAnknytning">Internationell anknytning</label>
                    <input type="text" id="editAnknytning">
                </div>
                <div class="form-group">
                    <label for="editFinansiering">Finansiering</label>
                    <input type="text" id="editFinansiering">
                </div>
                <div class="form-group">
                    <label for="editEtik">Etikgodkännande</label>
                    <select id="editEtik">
                        <option value="">Välj...</option>
                        <option value="Ja">Ja</option>
                        <option value="Ja, behövs">Ja, behövs</option>
                        <option value="Nej">Nej</option>
                        <option value="Måste undersökas">Måste undersökas</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editDatalagring">Datalagring</label>
                    <input type="text" id="editDatalagring">
                </div>
                <div class="form-group">
                    <label for="editPublikationer">Publikationer/resultat</label>
                    <textarea id="editPublikationer"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-danger" onclick="deleteProject(document.getElementById('editProjectIndex').value)">Radera projekt</button>
                    <button type="button" class="btn" onclick="closeEditModal()">Avbryt</button>
                    <button type="submit" class="btn btn-primary">Spara ändringar</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let projects = [
            { id: 1, namn: "Eftervåld och hälsa", datum: "2022-2025", projektledare: "Sara Skoog Waller", medarbetare: "", syfte: "Kartlägga och undersöka utsatthet för eftervåld bland kvinnor som utsatts för våld i en tidigare relation.", finansiering: "NCK", etik: "Ja", datalagring: "Uppsala universitet", publikationer: "", status: "Pågående", anknytning: "" },
            { id: 2, namn: "Teknologins roll i våld i nära relationer", datum: "2024-", projektledare: "Nicole Ovesen", medarbetare: "", syfte: "Undersöka dynamikerna för teknologibaserat våld, hur det kommer till uttryck i de våldsutsattas liv samt vilka vardagliga konsekvenser teknologin spelar för våldsutsatta kvinnor både under och efter relationens slut.", finansiering: "Etableringsbidrag från Forte, NCK", etik: "Ja", datalagring: "Uppsala universitet. Använder Allvis, UPPMAX, Vesta.", publikationer: "", status: "Pågående", anknytning: "" },
            { id: 3, namn: "En egen plats - stadigvarande boende för våldsutsatta", datum: "2024-2026", projektledare: "Sara Skoog Waller", medarbetare: "Ola Nordhall (HiG), Igor Knez (HiG), Candice Ståhl (HiG/ORU) och Alva Blomkvist (forskningsassistent)", syfte: "Projektet undersöker våldsutsatta kvinnors väg till stadigvarande boende och dess påverkan på deras identitet, hälsa och livskvalitet. Målet är att förbättra kommuners arbete och riktlinjer för att säkra dessa kvinnors boende.", finansiering: "Etableringsbidrag från Forte, Länsstyrelsen Gävleborg", etik: "Ja", datalagring: "Uppsala universitet. Använder Allvis, UPPMAX. OneDrive för rapportskrivning.", publikationer: "Rapport (publiceras sommaren 2025)", status: "Pågående", anknytning: "" },
            { id: 4, namn: "VIPROM - Victim Protection in Medicine", datum: "2023-2026", projektledare: "Bettina Pfleiderer", medarbetare: "Ulla Albért, Susanne Mattsson och Hadil Zainal Kamil", syfte: "Utbildning- och forskningsprojekt som syftar till att utveckla och implementera målgruppsspecifika utbildningar i våld i nära relation", finansiering: "EU-medel", etik: "", datalagring: "", publikationer: "", status: "Pågående", anknytning: "EU-samarbete mellan Sverige, Grekland, Italien, Österrike och Tyskland" },
            { id: 5, namn: "Mäns utsatthet för våld i nära relationer, hjälpsökande och stödbehov", datum: "2024-2025", projektledare: "Maja Bodin", medarbetare: "", syfte: "Öka kunskapen om mäns våldsutsatthet i nära relationer genom att studera hur våldet tar sig uttryck samt mäns hjälpsökande beteende och behov av stöd från myndigheter och andra organisationer.", finansiering: "JÄMY (Regeringsuppdrag)", etik: "Ja", datalagring: "", publikationer: "", status: "Pågående", anknytning: "" },
            { id: 6, namn: "HBTQI-personers hjälpsökande och stödbehov", datum: "2023-2025", projektledare: "Nicole Ovesen", medarbetare: "Renita Sörensdotter", syfte: "Syftet med forsknings-och kunskapsöversikten är att sammanställa och analysera den forskning och kunskap som finns om hjälpsökande och stödinsatser avseende gruppen hbtqi-personer som utsatts för våld i nära relationer", finansiering: "JÄMY/Socialstyrelsen (Regeringsuppdrag), NCK", etik: "", datalagring: "", publikationer: "Rapporten", status: "Pågående", anknytning: "" },
            { id: 7, namn: "Våldsutsatthet och screening för livmoderhalscancer", datum: "2024-2032", projektledare: "Shirin Ziaei", medarbetare: "Johanna Belachew, Linette Backeman (UU), Lena Liljeström (UU) och Malin Jordal (HiG)", syfte: "Forskningsstudie som undersöker orsakerna som kan ligga bakom att man eventuellt inte lämnar sin cellprov", finansiering: "NCK, ALF-medel", etik: "Ja", datalagring: "", publikationer: "", status: "Pågående", anknytning: "" },
            { id: 8, namn: "Forsknings- och kunskapsöversikt – om digitala dimensioner av våld i nära relationer", datum: "2024-2025", projektledare: "Sara Jakobsson", medarbetare: "Carolina Överlien och Alva Blomkvist (forskningsassistent)", syfte: "Syftet med översikten är att få en samlad bild av kunskapsläget gällande teknikens roll i partnervåld och hjälpsökande, vilka strategier och policys som finns på den nationella och internationella arenan som är relevanta för Sverige", finansiering: "JÄMY (Regeringsuppdrag)", etik: "Nej", datalagring: "Uppsala universitet. Lagrar artiklar och relevanta dokument i gemensamma arbetsytor i OneDrive och Argos.", publikationer: "Planerad rapport färdigställs oktober 2025.", status: "Pågående", anknytning: "" },
            { id: 9, namn: "Digitala stödinsatser: Innovativa sätt att ge stöd till unga via Snapchat", datum: "2024-2026", projektledare: "Sara Jakobsson", medarbetare: "Carolina Överlien, Nicole Ovesen, Sibel Korkmaz (SU) och Alva Blomkvist (forskningsassistent)", syfte: "Följeforskning om hur en verksamhet ger stöd via applikationen Snapchat. NCK kommer samla in och analysera chattloggar och statistik (ev. intervjuer) för att förhoppningsvis besvara frågeställningar kring innovativa sätt att ge stöd till våldsutsatta", finansiering: "Regeringskansliet/-JÄMY. Pågående ansökan till Allmänna Barnhuset", etik: "Ja", datalagring: "Uppsala universitet. Kommer lagra data i Allvis.", publikationer: "", status: "Pågående", anknytning: "" },
            { id: 10, namn: "Forsknings- och kunskapsöversikt - om sexuella trakasserier och systematiskt arbetsmiljöarbete", datum: "2023-2025", projektledare: "Anne-Charlotte Callerstig", medarbetare: "Anneli Häyrén", syfte: "Varför kommer vi inte åt problemet med sexuella trakasserier när det finns så många etablerade metoder och varför fungerar inte det systematiska arbetsmiljöarbetet som förebyggandeåtgärd", finansiering: "Mynak", etik: "", datalagring: "", publikationer: "Rapport under ht 25", status: "Pågående", anknytning: "" },
            { id: 11, namn: "Forsknings- och kunskapsöversikt - om hot och våld från tredje person/man med fokus på vård, skola och omsorg", datum: "2025", projektledare: "Anneli Häyrén", medarbetare: "Anne-Sofie Nyström", syfte: "Hur ser prevalensen ut? Hur ser våldet ut? Hur kopplas det till systematiskt arbetsmiljöarbete?", finansiering: "Mynak", etik: "", datalagring: "", publikationer: "25-Dec", status: "Pågående", anknytning: "" },
            { id: 12, namn: "Hedersrelaterat våld och förtryck i Norden", datum: "2024-2025", projektledare: "NIKK, Nordisk information för kunskap om kön", medarbetare: "Alexandra Lebedeva", syfte: "Att ge en överblick av arbetet i norden genom att belysa hur begreppet hedersrelaterat våld och förtyck definieras, vilka problem och utmaningar som identifieras och hur arbetet med att möta dessa utmaningar är organiserat", finansiering: "Nordiska ministerrådet", etik: "Nej", datalagring: "", publikationer: "", status: "Pågående", anknytning: "" },
            { id: 13, namn: "EMBER- Empowerment and Resilience-Based Recovery", datum: "2025-2029", projektledare: "Carolina Överlien", medarbetare: "Tove Filén, Johanna Belachew, Martin Cernvall", syfte: "Utvärdering av den resiliensbaserade metod som används kliniskt på Kvinnofridsmottagningen. Dessutom normering av ett skamformulär, EISS.", finansiering: "NCK", etik: "Ja", datalagring: "", publikationer: "", status: "Pågående", anknytning: "" },
            { id: 14, namn: "Befolkningsundersökningen våld och hälsa", datum: "2025-2028", projektledare: "Marcus Lindskog", medarbetare: "Everett Christensen, Sara Skoog Waller, Sara Jakobsson, Annika Töyrä, Carolina Överlien mfl", syfte: "Riksrepresentativ befolkningsstudie som på nationell nivå som ska studera utsatthet för våld hos befolkningen", finansiering: "Regeringskansliet/-Arbetsmarknadsdepartementet", etik: "Ja, behövs", datalagring: "Uppsala universitet", publikationer: "", status: "Planerad", anknytning: "" },
            { id: 15, namn: "NCK's stödlinjer", datum: "2025-2029", projektledare: "Marcus Lindskog", medarbetare: "Johanna Belachew, Maja Bodin, Etta Meyer Qvarnström", syfte: "Forskning/utvärdering av NCK:s stödlinjer.", finansiering: "NCK", etik: "", datalagring: "", publikationer: "", status: "Planerad", anknytning: "" },
            { id: 16, namn: "Stöd till våldsutsatta unga (ungarelationer.se)", datum: "2025-2029", projektledare: "Carolina Överlien", medarbetare: "Mirjam Nathansson", syfte: "Forskning/utvärdering av insatser och stöd via ungarelationer.se.", finansiering: "NCK, JÄMY", etik: "", datalagring: "", publikationer: "", status: "Planerad", anknytning: "" },
            { id: 17, namn: "Våldsförebyggande arbete genom utbildning om sexuella trakasserier", datum: "2026", projektledare: "Fredrik Alenius", medarbetare: "Anneli Häyrén, Maria Hyllebgren, Emma Von Sydow", syfte: "Vilka effekter får utbildning om sexuella trakasserier kopplat till förståelse om våld, på våld i andra kontexter än arbete", finansiering: "Söker från AFA", etik: "Ja, behövs", datalagring: "", publikationer: "", status: "Ansökan", anknytning: "" },
            { id: 18, namn: "NCK 2.0", datum: "2026", projektledare: "Anneli Häyrén", medarbetare: "Annie Woube, Jill Trenholm samt MIRakademin", syfte: "Hur kan vi starta och bygga upp en verksamhet som NCK utomlands? Vilka forskningsfördelar och utbyte kan det generera?", finansiering: "Daphne", etik: "Måste undersökas", datalagring: "", publikationer: "", status: "Ansökan", anknytning: "Partner i Aten och Vynitsa (Ukraina)" },
            { id: 19, namn: "SUN", datum: "2025", projektledare: "Anneli Häyrén", medarbetare: "Jill Trenholm, Hanna Palhamn Szabo", syfte: "Nätverksbyggande för forsknings- och utbildningssamarbete om våld i nära relaioner", finansiering: "SI", etik: "Nej", datalagring: "", publikationer: "", status: "Ansökan", anknytning: "Ska byggas i Kyiv, Ukraina" },
            { id: 20, namn: "Reproduktivt tvång (postdok)", datum: "2025", projektledare: "Maja Bodin", medarbetare: "", syfte: "En postdok-studie om reproduktivt tvång.", finansiering: "Vetenskapsrådet", etik: "", datalagring: "", publikationer: "", status: "Ansökan", anknytning: "" }
        ];

        let filteredProjects = [...projects];

        // Se till att alla befintliga projekt får ett unikt ID
        let nextId = projects.reduce((maxId, project) => Math.max(maxId, project.id || 0), 0) + 1;

        // Funktioner för Modal (Lägg till projekt)
        function openAddModal() {
            document.getElementById('addModal').classList.add('active');
        }

        function closeAddModal() {
            document.getElementById('addModal').classList.remove('active');
            document.getElementById('addProjectForm').reset(); // Rensa formuläret
        }

        // Funktioner för Modal (Redigera projekt)
        function openEditModal(index) {
            const project = filteredProjects[index];
            const originalIndex = projects.findIndex(p => p.id === project.id);
            
            document.getElementById('editProjectIndex').value = originalIndex; // Spara original-index i den fulla listan
            document.getElementById('editNamn').value = project.namn;
            document.getElementById('editStatus').value = project.status;
            document.getElementById('editDatum').value = project.datum || '';
            document.getElementById('editProjektledare').value = project.projektledare || '';
            document.getElementById('editMedarbetare').value = project.medarbetare || '';
            document.getElementById('editSyfte').value = project.syfte || '';
            document.getElementById('editAnknytning').value = project.anknytning || '';
            document.getElementById('editFinansiering').value = project.finansiering || '';
            document.getElementById('editEtik').value = project.etik || '';
            document.getElementById('editDatalagring').value = project.datalagring || '';
            document.getElementById('editPublikationer').value = project.publikationer || '';

            document.getElementById('editModal').classList.add('active');
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.remove('active');
            document.getElementById('editProjectForm').reset();
        }

        // Funktion: Spara redigerade projekt
        function saveEdit(event) {
            event.preventDefault();
            const originalIndex = document.getElementById('editProjectIndex').value;

            // Hämta värden från formuläret
            const updatedProject = {
                id: projects[originalIndex].id, // Behåll befintligt ID
                namn: document.getElementById('editNamn').value,
                status: document.getElementById('editStatus').value,
                datum: document.getElementById('editDatum').value,
                projektledare: document.getElementById('editProjektledare').value,
                medarbetare: document.getElementById('editMedarbetare').value,
                syfte: document.getElementById('editSyfte').value,
                anknytning: document.getElementById('editAnknytning').value,
                finansiering: document.getElementById('editFinansiering').value,
                etik: document.getElementById('editEtik').value,
                datalagring: document.getElementById('editDatalagring').value,
                publikationer: document.getElementById('editPublikationer').value,
            };

            // Uppdatera projektet i huvudlistan
            projects[originalIndex] = updatedProject;
            
            closeEditModal();
            applyFilters(); // Uppdatera vyn
        }

        // Funktion: Ändra status direkt från kortet
        function changeStatus(projectID, newStatus) {
            const projectIndex = projects.findIndex(p => p.id === projectID);
            if (projectIndex !== -1) {
                projects[projectIndex].status = newStatus;
                applyFilters(); // Uppdatera vyn och statistiken
            }
        }
        
        // Funktion: Lägg till nytt projekt
        function addProject(event) {
            event.preventDefault();

            const newProject = {
                id: nextId++, // Tilldela unikt ID
                namn: document.getElementById('newNamn').value,
                status: document.getElementById('newStatus').value,
                datum: document.getElementById('newDatum').value,
                projektledare: document.getElementById('newProjektledare').value,
                medarbetare: document.getElementById('newMedarbetare').value,
                syfte: document.getElementById('newSyfte').value,
                anknytning: document.getElementById('newAnknytning').value,
                finansiering: document.getElementById('newFinansiering').value,
                etik: document.getElementById('newEtik').value,
                datalagring: document.getElementById('newDatalagring').value,
                publikationer: document.getElementById('newPublikationer').value,
            };

            projects.unshift(newProject); // Lägg till i början
            closeAddModal();
            populateYearFilter(); // Uppdatera år-filtret
            applyFilters(); // Uppdatera vyn
        }

        // Funktion: Radera projekt
        function deleteProject(projectIndex) {
            const project = projects[projectIndex];
            if (confirm(`Är du säker på att du vill radera projektet: "${project.namn}"? Denna åtgärd kan inte ångras.`)) {
                // Ta bort från huvudlistan
                projects.splice(projectIndex, 1);
                
                closeEditModal(); // Stäng redigeringsmodalen om den är öppen
                populateYearFilter(); // Uppdatera år-filtret
                applyFilters(); // Uppdatera vyn och statistiken
            }
        }

        // ----------------------------------------------------------------------------------

        /**
         * Uppdaterar statistikkorten baserat på den aktuella listan med projekt.
         * @param {Array<Object>} projectsToCount - Projekten som ska räknas.
         */
        function updateStats(projectsToCount) {
            const counts = {
                'Pågående': 0,
                'Planerad': 0,
                'Ansökan': 0,
                'Avslutad': 0, // Avslutad räknas också i statistiken nu
            };

            projectsToCount.forEach(project => {
                if (counts[project.status] !== undefined) {
                    counts[project.status]++;
                }
            });

            document.getElementById('statPågående').textContent = counts['Pågående'];
            document.getElementById('statPlanerad').textContent = counts['Planerad'];
            document.getElementById('statAnsökan').textContent = counts['Ansökan'];
            document.getElementById('statTotal').textContent = projectsToCount.length;
        }

        /**
         * Hämtar unika startår från projektdata för att fylla i År-filtret.
         */
        function populateYearFilter() {
            const yearFilter = document.getElementById('yearFilter');
            // Rensa befintliga alternativ, behåll "Alla år"
            yearFilter.innerHTML = '<option value="">Alla år</option>'; 

            const years = new Set();

            projects.forEach(project => {
                // Extrahera det första året från datum-strängen (t.ex. "2024-2026" blir "2024")
                const startYearMatch = project.datum ? project.datum.match(/^(\d{4})/) : null;
                if (startYearMatch) {
                    years.add(startYearMatch[1]);
                }
            });

            // Sortera åren i fallande ordning (senaste först)
            const sortedYears = Array.from(years).sort().reverse();

            sortedYears.forEach(year => {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                yearFilter.appendChild(option);
            });
        }

        // ----------------------------------------------------------------------------------

        /**
         * Filtrerar och söker i projektlistan baserat på aktuella filtervärden.
         */
        function applyFilters() {
            const searchInput = document.getElementById('searchInput').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;
            const yearFilter = document.getElementById('yearFilter').value;

            filteredProjects = projects.filter(project => {
                // 1. Status Filter
                const statusMatch = statusFilter === '' || project.status === statusFilter;

                // 2. År Filter
                let yearMatch = true;
                if (yearFilter !== '') {
                    // Jämför med projektets startår
                    const startYearMatch = project.datum ? project.datum.match(/^(\d{4})/) : null;
                    const startYear = startYearMatch ? startYearMatch[1] : '';
                    yearMatch = startYear === yearFilter;
                }

                // 3. Search Input (Söker mot flera fält)
                const searchMatch = !searchInput ||
                    project.namn.toLowerCase().includes(searchInput) ||
                    project.projektledare.toLowerCase().includes(searchInput) ||
                    (project.medarbetare || '').toLowerCase().includes(searchInput) ||
                    (project.finansiering || '').toLowerCase().includes(searchInput);

                return statusMatch && yearMatch && searchMatch;
            });

            // Sortera: Pågående, Planerad, Ansökan, Avslutad
            const statusOrder = ['Pågående', 'Planerad', 'Ansökan', 'Avslutad'];
            filteredProjects.sort((a, b) => statusOrder.indexOf(a.status) - statusOrder.indexOf(b.status));

            renderProjects();
            updateStats(filteredProjects);
        }

        /**
         * Rendrerar projektkorten baserat på den filtrerade listan.
         */
        function renderProjects() {
            const projectsList = document.getElementById('projectsList');
            projectsList.innerHTML = '';

            if (filteredProjects.length === 0) {
                projectsList.innerHTML = `
                    <div class="no-results">
                        <div class="no-results-icon">😔</div>
                        <p>Hittade inga projekt som matchar dina filter.</p>
                        <p style="margin-top: 10px;">Prova att ändra dina sök- eller filterinställningar.</p>
                    </div>
                `;
                return;
            }

            filteredProjects.forEach((project, index) => {
                // Hitta det ursprungliga indexet i den fulla 'projects' arrayen.
                // Detta index används för att modifiera/radera projektet i huvudlistan.
                const originalIndex = projects.findIndex(p => p.id === project.id);

                const cardHtml = `
                    <div class="project-card">
                        <div class="project-header">
                            <div class="project-title">${project.namn}</div>
                            <div class="status-and-actions">
                                <select 
                                    class="status-select" 
                                    onchange="changeStatus(${project.id}, this.value)">
                                    <option value="Pågående" ${project.status === 'Pågående' ? 'selected' : ''}>Pågående</option>
                                    <option value="Planerad" ${project.status === 'Planerad' ? 'selected' : ''}>Planerad</option>
                                    <option value="Ansökan" ${project.status === 'Ansökan' ? 'selected' : ''}>Ansökan</option>
                                    <option value="Avslutad" ${project.status === 'Avslutad' ? 'selected' : ''}>Avslutad</option>
                                </select>
                                <button class="action-btn" onclick="openEditModal(${index})">Redigera</button>
                                <button class="action-btn delete" onclick="deleteProject(${originalIndex})">Radera</button>
                            </div>
                        </div>
                        <div class="project-meta">
                            <div class="meta-item">
                                <div class="meta-label">Projektledare:</div>
                                <div class="meta-value">${project.projektledare || 'Ej angiven'}</div>
                            </div>
                            <div class="meta-item">
                                <div class="meta-label">Tidsperiod:</div>
                                <div class="meta-value">${project.datum || 'Ej angiven'}</div>
                            </div>
                            <div class="meta-item">
                                <div class="meta-label">Finansiering:</div>
                                <div class="meta-value">${project.finansiering || 'Ej angiven'}</div>
                            </div>
                            <div class="meta-item">
                                <div class="meta-label">Internationellt:</div>
                                <div class="meta-value">${project.anknytning || 'Nej'}</div>
                            </div>
                            <div class="meta-item" style="grid-column: 1 / -1;">
                                <div class="meta-label">Syfte/Frågor:</div>
                                <div class="meta-value">${project.syfte || 'Ej angivet'}</div>
                            </div>
                            <div class="meta-item">
                                <div class="meta-label">Etikgodkännande:</div>
                                <div class="meta-value">${project.etik || 'Ej angiven'}</div>
                            </div>
                            <div class="meta-item">
                                <div class="meta-label">Datalagring:</div>
                                <div class="meta-value">${project.datalagring || 'Ej angiven'}</div>
                            </div>
                            <div class="meta-item" style="grid-column: 1 / -1;">
                                <div class="meta-label">Medarbetare:</div>
                                <div class="meta-value">${project.medarbetare || 'Ej angivna'}</div>
                            </div>
                            <div class="meta-item" style="grid-column: 1 / -1;">
                                <div class="meta-label">Publikationer/Resultat:</div>
                                <div class="meta-value">${project.publikationer || 'Ej publicerat ännu'}</div>
                            </div>
                        </div>
                    </div>
                `;
                projectsList.insertAdjacentHTML('beforeend', cardHtml);
            });
        }

        // Initiera vid sidladdning
        document.addEventListener('DOMContentLoaded', () => {
            populateYearFilter();
            applyFilters(); // Rendera initiala projekt och statistik
        });

    </script>
</body>
</html>
